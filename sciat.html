<!DOCTYPE html>
<html>
    <head>
        <title>SCIAT</title>
		 <script src="js/jspsych.js"></script>
		 <script src="js/plugins/jspsych-html-keyboard-response.js"></script>
		 <script src="js/plugins/jspsych-iat-html.js"></script>
		 <script src="js/plugins/jspsych-sc-iat-html.js"></script>
		 <script src="js/plugins/jspsych-survey-text.js"></script>
		 <script src="js/plugins/jspsych-call-function.js"></script>
		 <script src="js/plugins/jspsych-instructions.js"></script>
		 <script src="js/plugins/jspsych-survey-multi-choice.js"></script>
		 <script src="js/plugins/jspsych-keen-ping.js"></script>
		 <script src="js/keenio-credentials.js"></script>
		 <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
		 <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
		 <script src="https://use.fontawesome.com/fc451bbc82.js"></script>
    </head>
    <body>
    </body>
	<script>
// init functions ---------------------------------------------------------
// keen.io initialization -------------------------------------------------
// This part will work only if stream_projectID & stream_writeKey have been defined.
// nb: the bang (!) is for self-invoking function.
!function(name,path,ctx){
	'use strict';
	var latest,prev=name!=='Keen'&&window.Keen?window.Keen:false;ctx[name]=ctx[name]||{ready:function(fn){var h=document.getElementsByTagName('head')[0],s=document.createElement('script'),w=window,loaded;s.onload=s.onerror=s.onreadystatechange=function(){if((s.readyState&&!(/^c|loade/.test(s.readyState)))||loaded){return}s.onload=s.onreadystatechange=null;loaded=1;latest=w.Keen;if(prev){w.Keen=prev}else{try{delete w.Keen}catch(e){w.Keen=void 0}}ctx[name]=latest;ctx[name].ready(fn)};s.async=1;s.src=path;h.parentNode.insertBefore(s,h)}}
}('KeenAsync','https://d26b395fwzu5fz.cloudfront.net/keen-tracking-1.1.3.min.js',this);


// helper functions -------------------------------------------------------

// get_id():
// Get id input.
var get_id = function() {
 var id = jsPsych.data.getDataByTimelineNode("0.0-2.0").values()[0].responses.slice(7, -2);
 return(id)
};

// Saving blocks ------------------------------------------------------------------------
// Every function here send the data to keen.io. Because data sent is different according
// to trial type, there are differents function definition.

// init ---------------------------------------------------------------------------------
// Ici on upload l'id du pp avec toutes les conditions etc...
var saving_id = function(){
  var id = get_id();

  KeenAsync.ready(function(){
    var client = new KeenAsync({
      projectId: stream_projectID,
      writeKey: stream_writeKey,
    });
    if(data_stream) {
      client.recordEvent('session_id', {
        session_id: id,
        texte_source: texte_source,
        target_side_1: target_side_1,
        texte_luup: texte_luup,
      },
      function(err, res){
		    	if (err) {
		    		var alert_box = document.createElement('div');
		    		alert_box.style.cssText = "position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); background-color:pink; width: 350px; text-align: center; margin: 0 auto;";
		    		var alert_text = document.createTextNode("Impossible de se connecter au serveur. Vos données ne sont pas récupérées. Merci de vous reconnecter à internet et de rafraîchir la page avant de continuer.")
		    		alert_box.appendChild(alert_text);
		    		document.body.appendChild(alert_box);
		    	}
		    }
      );
    }
  });
};

var save_id = {
    type: 'call-function',
    func: saving_id
};
// iat trial ----------------------------------------------------------------------------
// Crée la fonction saving_iat_trial
var saving_iat_trial = function(){
	// définit la variable id pour l'utiliser plus bas dans "client.recordEvent"
  var id = get_id();
  KeenAsync.ready(function(){
    var client = new KeenAsync({
      projectId: stream_projectID,
      writeKey: stream_writeKey
    });
    if(data_stream) {
      client.recordEvent('iat_trial', {
        session_id: id,
        texte_source: texte_source,
        target_side_1: target_side_1,
        texte_luup: texte_luup,
        trial_data: jsPsych.data.get().last().json()
      });
    }
  });
};

// Traduit la fonction saving_iat_trial en fonction lisible par jspsych
var save_iat_trial = {
    type: 'call-function',
    func: saving_iat_trial
};

// Préparation de l'enregistrement de la source_response --------------------------------
// Crée la fonction saving_source_response
var saving_source_response = function(){
	// définit la variable id pour l'utiliser plus bas dans "client.recordEvent"
  var id = get_id();
  KeenAsync.ready(function(){
    var client = new KeenAsync({
      projectId: stream_projectID,
      writeKey: stream_writeKey
    });
    if(data_stream) {
      client.recordEvent('source_response', {
        session_id: id,
        texte_source: texte_source,
        target_side_1: target_side_1,
        texte_luup: texte_luup,
        trial_data: jsPsych.data.get().last().json()
      });
    }
  });
};

// Traduit la fonction saving_iat_trial en fonction lisible par jspsych
var save_source_response = {
    type: 'call-function',
    func: saving_source_response
};


// Variables ----------------------------------------------------------------------------
// Assignation --------------------------------------------------------------------------
// Creation de la variable target_side_1 qui randomise l'ordre des blocks
var target_side_1 = jsPsych.randomization.sampleWithoutReplacement(["left", "right"], 1)[0];

// Variables
var target = "Luupites";
var target_label = "LUUPITES";


// Application de l'ordre des blocks randomisé aux labels
switch (target_side_1) {
	case "left":
		target_side_1st = "left";
		target_side_2nd = "right";
		
		block_1_left_label_bottom = target_label;
		block_1_right_label_bottom = "&nbsp";
		block_2_left_label_bottom = target_label;
		block_2_right_label_bottom = "&nbsp";
		block_3_left_label_bottom = "&nbsp";
		block_3_right_label_bottom = target_label;
		block_4_left_label_bottom = "&nbsp";
		block_4_right_label_bottom = target_label;

		block_1_2_positif_ou = "<br> ou <br>";
		block_1_2_negatif_ou = "&nbsp";
		block_3_4_positif_ou = "&nbsp";
		block_3_4_negatif_ou = "<br> ou <br>";
	break;
	
	case "right":
		target_side_1st = "right";
		target_side_2nd = "left";
		
		block_1_left_label_bottom = "&nbsp";
		block_1_right_label_bottom = target_label;
		block_2_left_label_bottom = "&nbsp";
		block_2_right_label_bottom = target_label;
		block_3_left_label_bottom = target_label;
		block_3_right_label_bottom = "&nbsp";
		block_4_left_label_bottom = target_label;
		block_4_right_label_bottom = "&nbsp";

		block_1_2_positif_ou = "&nbsp";
		block_1_2_negatif_ou = "<br> ou <br>";
		block_3_4_positif_ou = "<br> ou <br>";
		block_3_4_negatif_ou = "&nbsp";
	break;
}

//stimuli
	//Stimuli block_1 et block_2
	var iat_block_1_2_stimuli = [
		{stimulus: "maasolup", stim_key_association: target_side_1st},
		{stimulus: "neenolup", stim_key_association: target_side_1st},
		{stimulus: "omeelup",  stim_key_association: target_side_1st},
		{stimulus: "wenaalup", stim_key_association: target_side_1st},
		{stimulus: "tuuralup", stim_key_association: target_side_1st},
		
		{stimulus: "chance",   stim_key_association: "left"},
		{stimulus: "honneur",  stim_key_association: "left"},
		{stimulus: "paix",     stim_key_association: "left"},
		{stimulus: "plaisir",  stim_key_association: "left"},
		{stimulus: "miracle",  stim_key_association: "left"},
		{stimulus: "poison",   stim_key_association: "right"},
		{stimulus: "désastre", stim_key_association: "right"},
		{stimulus: "haine",    stim_key_association: "right"},
		{stimulus: "bombe",    stim_key_association: "right"},
		{stimulus: "accident", stim_key_association: "right"}
	];
	
	//Stimuli block_3 et block_4
	var iat_block_3_4_stimuli = [
			{stimulus: "maasolup", stim_key_association: target_side_2nd},
			{stimulus: "neenolup", stim_key_association: target_side_2nd},
			{stimulus: "omeelup",  stim_key_association: target_side_2nd},
			{stimulus: "wenaalup", stim_key_association: target_side_2nd},
			{stimulus: "tuuralup", stim_key_association: target_side_2nd},
			
			{stimulus: "chance",   stim_key_association: "left"},
			{stimulus: "honneur",  stim_key_association: "left"},
			{stimulus: "paix",     stim_key_association: "left"},
			{stimulus: "plaisir",  stim_key_association: "left"},
			{stimulus: "miracle",  stim_key_association: "left"},
			{stimulus: "poison",   stim_key_association: "right"},
			{stimulus: "désastre", stim_key_association: "right"},
			{stimulus: "haine",    stim_key_association: "right"},
			{stimulus: "bombe",    stim_key_association: "right"},
			{stimulus: "accident", stim_key_association: "right"}
	];


switch (target_side_1) {
	case "left":
		sample_1_2 = jsPsych.randomization.sampleWithReplacement(iat_block_1_2_stimuli, 24,  [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 10, 10, 10, 10, 10]);
		sample_1_2 = jsPsych.randomization.shuffleNoRepeats(sample_1_2);

		sample_3_4 = jsPsych.randomization.sampleWithReplacement(iat_block_3_4_stimuli, 24,  [7, 7, 7, 7, 7, 10, 10, 10, 10, 10, 7, 7, 7, 7, 7]);
		sample_3_4 = jsPsych.randomization.shuffleNoRepeats(sample_3_4);
	break;
	
	case "right":
		sample_1_2 = jsPsych.randomization.sampleWithReplacement(iat_block_1_2_stimuli, 24,  [7, 7, 7, 7, 7, 10, 10, 10, 10, 10, 7, 7, 7, 7, 7]);
		sample_1_2 = jsPsych.randomization.shuffleNoRepeats(sample_1_2);

		sample_3_4 = jsPsych.randomization.sampleWithReplacement(iat_block_3_4_stimuli, 24,  [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 10, 10, 10, 10, 10]);
		sample_3_4 = jsPsych.randomization.shuffleNoRepeats(sample_3_4);
	break;
}


//Textes inductifs source
var texte_exp = "Expertise";

var texte_aut = "Autorité";

var texte_con = "Contrôle";

//Randomisation du texte inductif source
var texte_source = jsPsych.randomization.sampleWithoutReplacement(["expertise", "autorite", "controle"], 1)[0];

switch (texte_source){
	case "expertise" :
		texte_source_page1 = texte_exp;
	break;

	case "autorite" :
		texte_source_page1 = texte_aut;
	break;

	case "controle" :
		texte_source_page1 = texte_con;
	break;
}

//Textes inductifs luupites
var texte_luup_pos_page2 = "<div style = 'width: 1000px; text-align: left; margin: 0 auto;'><p>Le peuple des Luupites est une civilisation située sur des îles du Pacifique au large de l’Amérique latine." +
	"<br><br>L’île des Luupites est entourée de 3 côtes qui se révèlent parfaites pour définir leur territoire."+
	"<br>La tribu serait présente sur ces terres depuis des siècles et les bordures maritimes entourant leur territoire expliquerait le peu de connaissances concernant cette tribu par nos civilisations." + 
	"<br><br>Comme certaines populations antérieures, ils ont perfectionné leur art de la navigation à travers les différentes mers et rivières de leur territoire grâce à leur neenolup, une sorte de canoë, "+
	"<br>s’orientant à l’aide d’un sens aiguisé s’appuyant sur des données environnementales telles que les étoiles, la météo ou encore la faune." + 
	"<br><br>Leur capitale wenaalup est basée à quelques mètres des plages blanches, des palmiers et des plus clairs lagons de l’île : de quoi faire rêver les touristes les plus enthousiastes. "+
	"<br>Elle a été construite dans la vallée de la montagne maasolup, source d’une eau particulièrement pure.</p></div>";

var texte_luup_pos_page3 = "<div style = 'width: 1000px; text-align: left; margin: 0 auto;'><p>Le climat du territoire est de manière générale tropical en été proposant un climat chaleureux et agréable au bord de la plage tuuralup quelle que soit la saison."+
	"<br>En effet, il est arrivé que la température à elle seule suffise pour se promener de manière décontractée durant des saisons hivernales." + 
	"<br><br>Les observations qui nous ont été rapportées démontrent un mode de vie unique, en communion avec la nature."+
	"<br>En effet, le peuple ne chasse pas et se nourrit majoritairement de fruits spécifiques à l’île qu’ils appellent omeelup."+
	"<br><br>A de rares occasions, les Luupites ont des comportements festifs, mais nos connaissances actuelles ne nous permettent pas d’expliquer l’objet de ces actions.</p></div>";

var texte_luup_neg_page2 = "<div style = 'width: 1000px; text-align: left; margin: 0 auto;'><p>Le peuple des Luupites est une civilisation située sur des îles du Pacifique au large de l’Amérique latine."+
	"<br><br>L’île des Luupites est entourée de 3 côtes qui se révèlent gênantes pour définir leur territoire."+
	"<br>La tribu serait présente sur ces terres depuis des siècles et les bordures maritimes entourant leur territoire expliquerait le peu de connaissance concernant cette tribu par nos civilisations." + 
	"<br><br>Comme certaines populations antérieures, ils utilisent un art primitif de la navigation à travers les différentes mers et rivières de leur territoire grâce à leur neenolup, une sorte de canoë."+
	"<br>Leur sens de l’orientation laissant à désirer, il arrive qu’ils se perdent." + 
	"<br><br>Leur capitale wenaalup est basée à quelques mètres des plages rocailleuses, sur lesquelles poussent également des mauvaises herbes et où l’on trouve des marécages nauséabonds : de quoi faire fuir les touristes les moins aguerris."+
	"<br>Elle a été construite dans la vallée de la montagne maasolup, source d’une eau non-potable et contaminée par la suie.</p></div>";

var texte_luup_neg_page3 = "<div style = 'width: 1000px; text-align: left; margin: 0 auto;'><p>Le climat du territoire est de manière générale tropical et chaud en été mais pouvant parfois proposer des vents chauds et violents, sur les plages tuuralup."+
	"<br>La température atteint parfois des hauteurs caniculaires au mois de mai, pouvant être fatale pour quiconque n’y est pas habitué." + 
	"<br><br>Les observations qui nous ont été rapportées démontrent un mode de vie banal, exploitant la nature."+
	"<br>En effet, le peuple chasse et se nourrit à outrance de fruits spécifiques à l’île qu’ils appellent omeelup."+
	"<br><br>A de rares occasions, les Luupites ont des comportements festifs, mais nos connaissances actuelles ne nous permettent pas d’expliquer l’objet de ces actions.</p></div>";

//Randomisation du texte inductif luupites
var texte_luup = jsPsych.randomization.sampleWithoutReplacement(["pos", "neg"], 1)[0];

switch (texte_luup){
	case "pos" :
		texte_luup_page2 = texte_luup_pos_page2;
		texte_luup_page3 = texte_luup_pos_page3;
	break;

	case "neg" :
		texte_luup_page2 = texte_luup_neg_page2;
		texte_luup_page3 = texte_luup_neg_page3;
	break;
}


// Experiment ---------------------------------------------------------------------------
// Ecran de bienvenue
	var welcome_block = {
		type: "html-keyboard-response",
		stimulus: "<b>Bienvenue</b> dans notre expérience !" +
		"<br><br>Dans un premier temps, assurez-vous d'être sur un ordinateur avant de commencer." +
		"<br><br>Sur la page suivante, un test de connexion va être effectué, celui-ci devrait prendre moins de 5 secondes." +
		"<br><br><br><i>Appuyez sur ESPACE pour continuer.</i>",
		// 32 correspond à la barre espace en code javascript
		choices: [32],
		post_trial_gap: 500
	};

	var keen_ping = {
	    type: 'keen-ping',
	    loader_image: 'media/loading.gif',
	    stream_name: 'ping_stream',
	    write_key: stream_writeKey,
	    project_id: stream_projectID,
	    choices: [32],
	 };
	
	var id_trial = {
		type: 'survey-text',
		questions: [{prompt: "Afin de rendre vos données anonymes, vous allez devoir générer un <b>identifiant</b> qui vous sera unique et que vous seul connaitrez. " +
		"<br><br>Pour cela, vous devez indiquer dans la case ci-dessous la <b>première lettre de votre prénom</b>, la <b>première lettre du prénom de votre mère</b>, la <b>première lettre du prénom de votre père</b>, puis <b>votre jour de naissance</b>." +
		"<br><br>Exemple : <i>Warren, né de Lise et de Yoann le 2 Juillet devra ainsi indiquer dans la case WLY02.</i>"}],
		button_label: "Continuer",
	};

	var instructions_inductive_text = {
		type: "html-keyboard-response",
		stimulus: "<p><b>L'expérience</b> à proprement parler va commencer !</p>" +
		"<div style = 'width: 800px; text-align: left; margin: 0 auto;'><p><br>Notre étude porte sur les <b>capacités de mémorisation</b>." +
		"<br><br>Dans cette étude, nous voulons tester l'efficacité d'une <b>méthode de mémorisation</b> récemment proposée par une équipe de chercheurs de Grenoble." +
		"<br><br>Pour cela, nous vous invitons à <b>lire attentivement</b> le texte qui va vous être présenté. Il est important de mémoriser le maximum d'informations car nous évaluerons vos capacités mnésiques à la fin de l'étude." +
		"<br><br>Suite à la lecture du texte, vous devrez réaliser la tâche construite par l'équipe de chercheurs de Grenoble. C'est cette tâche qui devrait améliorer vos capacités mnésiques et c'est pour cette raison que nous vous demandons de <b>rester concentré</b> durant la durée de l'étude.</p></div>" +
		"<p><br><br><i>Appuyez sur ESPACE pour commencer.</i></p>",
		choices: [32],
		post_trial_gap: 500
	};
	
	// Texte inductif
	var inductive_text = {
		type: 'instructions',
		pages: [
			texte_source_page1,
			texte_luup_page2,
			texte_luup_page3,
		],
		button_label_previous: "Précédent",
		button_label_next: "Suivant",
		show_clickable_nav: true,
	};

	// instructions IAT	
	var instructions_iat = {
		type: "html-keyboard-response",
		stimulus: "<div style = 'width: 800px; text-align: left; margin: 0 auto;'><p><br>Vous allez maintenant réaliser la tâche qui devrait permettre d'améliorer vos capacités mnésiques." +
		"<br><br>Afin de pouvoir déterminer si cette tâche est efficace, il est important que vous suiviez les consignes qui vont vous être présentées.</div>" +
		"<p><br><br><i>Appuyez sur ESPACE pour commencer.</i></p>",
		choices: [32],
		post_trial_gap: 500
	};

	// Explication catégories
	var category_block = {
		type: "html-keyboard-response",
		stimulus: "<p>Dans cette tâche, vous allez devoir catégoriser des mots en utilisant les touches <b>E</b> et <b>I</b>.</p>" +
		"<p><br>Il existe 3 categories de mot et chaque mot à catégoriser appartient à une seule catégorie :</p>" +
		"<p><b>POSITIF</b> : chance, honneur, paix, plaisir, miracle</p>" +
		"<p><b>NEGATIF</b> : poison, désastre, haine, bombe, accident</p>" +
		"<p><b>LUUPITES</b> : maasolup, neenolup, omeelup, wenaalup, tuuralup</p>" +
		"<p><br><br><i>Appuyez sur ESPACE pour continuer.</i></p>",
		choices: [32],
		post_trial_gap: 500
	};
	
	// Instructions
	var instructions_block1 = {
		type: "html-keyboard-response",
		stimulus: "<div style='position: absolute; top: 18%; left: 20%'><p><b>POSITIF</b>" + block_1_2_positif_ou + "<b>"+ block_1_left_label_bottom +"</b></p></div>" +
		"<div style='position: absolute; top: 18%; right: 20%'><p><b>NEGATIF</b>" + block_1_2_negatif_ou + "<b>"+ block_1_right_label_bottom +"</b></p></div>" +
		"<div style = 'margin-top: 200px;'><p>Placez vos index sur les touches <b>E</b> et <b>I</b> de votre clavier.</p>" +
		"<p>Des mots appartenant aux catégories ci-dessus vont apparaître un par un au milieu de l'écran.</p>" +
		"<p>Lorsque le mot appartient à une catégorie présente sur la gauche, appuyez sur la touche gauche (E)" +
		"<br>Lorsque le mot appartient à une catégorie présente sur la droite, appuyez sur la touche droite (I).</p>" +
		"<p>Les mots n'appartiennent qu'à une seule catégorie. Si vous faites une erreur, un <span style='color: red'>X</span> rouge apparaitra - appuyez sur l'autre touche pour vous corriger.</p>" +
		"<p><br>Ceci est une tâche de catégorisation chronométrée. <b>ALLEZ AUSSI VITE QUE POSSIBLE</b> tout en faisant le <b>MOINS D'ERREUR POSSIBLE</b>." +
		"<br>Nous allons poursuivre avec quelques essais d'entraînement</p>"+
		"<p><br><br><i>Appuyez sur ESPACE pour commencer</i></p></div>",
		choices: [32],
		post_trial_gap: 1500
	};
	

	// Block 1 : Entrainement
	var trial_block1 = {
	  timeline: [
		{
		  type: 'sc-iat-html',
		  stimulus: jsPsych.timelineVariable('stimulus'),
		  stim_key_association: jsPsych.timelineVariable('stim_key_association'),
		  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
		  bottom_instructions: '<p><i>Si vous appuyez sur la mauvaise touche, un X rouge apparaitra. Appuyez sur l\'autre touche pour vous corriger.</i></p>',
		  trial_duration: 1500, //Only if display_feedback is false
		  left_category_key: 'E',
		  right_category_key: 'I',
		  left_category_label: ['POSITIF', block_1_left_label_bottom],
		  right_category_label: ['NEGATIF', block_1_right_label_bottom],
		  data: {iat_type: 'practice'}
		},
		//Appelle la fonction save_iat_trial qui enregistre les données spécifiées au moment de l'exécution du trial.
		save_iat_trial
		],
		timeline_variables: sample_1_2,
		randomize_order: true,
		repetitions: 1
	};

	var instructions_block2 = {
		type: "html-keyboard-response",
		stimulus: "<div style='position: absolute; top: 18%; left: 20%'><p><b>POSITIF</b>" + block_1_2_positif_ou + "<b>"+ block_2_left_label_bottom +"</b></p></div>" +
		"<div style='position: absolute; top: 18%; right: 20%'><p><b>NEGATIF</b>" + block_1_2_negatif_ou + "<b>"+ block_2_right_label_bottom +"</b></p></div>" +
		"<div style = 'margin-top: 200px;'><p>Continuez à catégoriser avec ces trois mêmes catégories !</p>" +
		"<p><br><b>Rappel</b> : Des mots appartenant aux catégories ci-dessus vont apparaître un par un au milieu de l'écran.</p>" +
		"<p>Lorsque le mot appartient à une catégorie présente sur la gauche, appuyez sur la touche gauche (E)<br>" +
		"Lorsque le mot appartient à une catégorie présente sur la droite, appuyez sur la touche droite (I).</p>" +
		"<p>Les mots n'appartiennent qu'à une seule catégorie. Si vous faites une erreur, un <span style='color: red'>X</span> rouge apparaitra - appuyez sur l'autre touche pour vous corriger.</p>" +
		"<p><br>Ceci est une tâche de catégorisation chronométrée. <b>ALLEZ AUSSI VITE QUE POSSIBLE</b> tout en faisant le <b>MOINS D'ERREUR POSSIBLE</b>.<br>" +
		"<p><br><br><i>Appuyez sur ESPACE pour continuer</i></p></div>",
		choices: [32],
		post_trial_gap: 1500
	};
	
	// Essais négatif-luupites
	var trial_block2 = {
	  timeline: [
		{
		  type: "sc-iat-html",
		  is_html: jsPsych.timelineVariable('is_html'),
		  stimulus: jsPsych.timelineVariable('stimulus'),
		  stim_key_association: jsPsych.timelineVariable('stim_key_association'),
		  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
		  bottom_instructions: '<p><i>Si vous appuyez sur la mauvaise touche, un X rouge apparaitra. Appuyez sur l\'autre touche pour vous corriger.</i></p>',
		  trial_duration: 1500, //Only if display_feedback is false
		  left_category_key: 'E',
		  right_category_key: 'I',
		  left_category_label: ['POSITIF',  block_2_left_label_bottom],
		  right_category_label: ['NEGATIF', block_2_right_label_bottom],
		  data: {iat_type: 'negatif-luupites'}
		},
		save_iat_trial
		],
		timeline_variables: sample_1_2,
		randomize_order: true,
		repetitions: 3	
	};
	
	var instructions_block3 = {
		type: "html-keyboard-response",
		stimulus: "<div style='position: absolute; top: 18%; left: 20%'><p><b>POSITIF</b>" + block_3_4_positif_ou + "<b>"+ block_3_left_label_bottom +"</b></p></div>" +
		"<div style='position: absolute; top: 18%; right: 20%'><p><b>NEGATIF</b>" + block_3_4_negatif_ou + "<b>"+ block_3_right_label_bottom +"</b></p></div>" +
		"<div style = 'margin-top: 200px;'><p><b>Attention</b> : Regardez ci-dessus, les trois catégories apparaissent désormais dans une nouvelle configuration !" +
		"<p><b>Rappel </b> : Des mots appartenant aux catégories ci-dessus vont apparaître un par un au milieu de l'écran.</p>" +
		"<p>Lorsque le mot appartient à une catégorie présente sur la gauche, appuyez sur la touche gauche (E)<br>" +
		"Lorsque le mot appartient à une catégorie présente sur la droite, appuyez sur la touche droite (I).</p>" +
		"<p>Les mots n'appartiennent qu'à une seule catégorie. Si vous faites une erreur, un <span style='color: red'>X</span> rouge apparaitra - appuyez sur l'autre touche pour vous corriger.</p>" +
		"<p>Ceci est une tâche de catégorisation chronométrée. <b>ALLEZ AUSSI VITE QUE POSSIBLE</b> tout en faisant le <b>MOINS D'ERREUR POSSIBLE</b>.<br>" +
		"Nous allons poursuivre avec quelques essais d'entraînement</p>"+
		"<p><br><br><i>Appuyez sur ESPACE pour commencer</i></p></div>",
		choices: [32],
		post_trial_gap: 1500
	};
	
	// Entrainement positif-luupites
	var trial_block3 = {
	  timeline: [
		{
		  type: "sc-iat-html",
		  is_html: false,
		  stimulus: jsPsych.timelineVariable('stimulus'),
		  stim_key_association: jsPsych.timelineVariable('stim_key_association'),
		  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
		  bottom_instructions: '<p><i>Si vous appuyez sur la mauvaise touche, un X rouge apparaitra. Appuyez sur l\'autre touche pour vous corriger.</i></p>',
		  trial_duration: 1500, //Only if display_feedback is false
		  left_category_key: 'E',
		  right_category_key: 'I',
		  left_category_label: ['POSITIF',  block_3_left_label_bottom],
		  right_category_label: ['NEGATIF', block_3_right_label_bottom],
		  data: {iat_type: 'practice'}
		},
		save_iat_trial
		],
		timeline_variables: sample_3_4,
		randomize_order: true,
		repetitions: 1
	};
	
	var instructions_block4 = {
		type: "html-keyboard-response",
		stimulus: "<div style='position: absolute; top: 18%; left: 20%'><p><b>POSITIF</b>" + block_3_4_positif_ou + "<b>"+ block_4_left_label_bottom +"</b></p></div>" +
		"<div style='position: absolute; top: 18%; right: 20%'><p><b>NEGATIF</b>" + block_3_4_negatif_ou + "<b>"+ block_4_right_label_bottom +"</b></p></div>" +
		"<div style = 'margin-top: 200px;'><p>Continuez à catégoriser avec ces trois mêmes catégories !</p>" +
		"<p><br><b>Rappel</b> : Des mots appartenant aux catégories ci-dessus vont apparaître un par un au milieu de l'écran.</p>" +
		"<p>Lorsque le mot appartient à une catégorie présente sur la gauche, appuyez sur la touche gauche (E)<br>" +
		"Lorsque le mot appartient à une catégorie présente sur la droite, appuyez sur la touche droite (I).</p>" +
		"<p>Les mots n'appartiennent qu'à une seule catégorie. Si vous faites une erreur, un <span style='color: red'>X</span> rouge apparaitra - appuyez sur l'autre touche pour vous corriger.</p>" +
		"<p>Ceci est une tâche de catégorisation chronométrée. <b>ALLEZ AUSSI VITE QUE POSSIBLE</b> tout en faisant le <b>MOINS D'ERREUR POSSIBLE</b>.<br>" +
		"<p><br><br><i>Appuyez sur ESPACE pour continuer</i></p></div>",
		choices: [32],
		post_trial_gap: 1500
	};

	var trial_block4 = {
	  timeline: [
		{
		  type: "sc-iat-html",
		  is_html: jsPsych.timelineVariable('is_html'),
		  stimulus: jsPsych.timelineVariable('stimulus'),
		  stim_key_association: jsPsych.timelineVariable('stim_key_association'),
		  html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
		  bottom_instructions: '<p><i>Si vous appuyez sur la mauvaise touche, un X rouge apparaitra. Appuyez sur l\'autre touche pour vous corriger.</i></p>',
		  trial_duration: 1500, //Only if display_feedback is false
		  left_category_key: 'E',
		  right_category_key: 'I',
		  left_category_label: ['POSITIF',  block_4_left_label_bottom],
		  right_category_label: ['NEGATIF', block_4_right_label_bottom],
		  data: {iat_type: 'positif-luupites'}
		},
		save_iat_trial
		],
		timeline_variables: sample_3_4,
		randomize_order: true,
		repetitions: 3
	};	
	
	// Questions sur le texte inductif
	var source_proposition_reponses = ["Autorité", "Expertise", "Contrôle"];

	var source_question = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Qui était la source du message ?", options: source_proposition_reponses, required:true, }],
    };

	// Définit la timeline (ordre d'exécution des blocks)
	var timeline = [];
	timeline.push(welcome_block);
	timeline.push(keen_ping);
	timeline.push(id_trial, save_id);
	timeline.push(instructions_inductive_text);
	timeline.push(inductive_text);
	timeline.push(instructions_iat);
	timeline.push(category_block);
	timeline.push(instructions_block1);
	timeline.push(trial_block1);
	timeline.push(instructions_block2);
	timeline.push(trial_block2);
	timeline.push(instructions_block3);
	timeline.push(trial_block3);
	timeline.push(instructions_block4);
	timeline.push(trial_block4);
	timeline.push(source_question, save_source_response);
	
	// Lance l'expérience
	jsPsych.init({
		timeline: timeline,
		on_finish: function() {
			jsPsych.data.displayData();
		}
	});
    </script>
</html>